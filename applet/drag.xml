<?xml version="1.0"?>
<html xmlns="http://www.w3.org/1999/xhtml"
  xmlns:svg="http://www.w3.org/2000/svg" 
  xmlns:xul="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul"
>
  <head>
  
  <script>
    <![CDATA[
    var dx,dy;
    var nodes;
    var edges;
    var selectedNode;

    function init()
    {
      edges = new Array();
      edges[0] = new Array();
      edges[1] = new Array();
      edges[2] = new Array();
      edges[3] = new Array();
      edges[0][1] = document.getElementById('edge01');
      edges[0][2] = document.getElementById('edge02');
      edges[0][3] = document.getElementById('edge03');
      edges[1][0] = document.getElementById('edge01');
      edges[1][2] = document.getElementById('edge12');
      edges[1][3] = document.getElementById('edge13');
      edges[2][0] = document.getElementById('edge02');
      edges[2][1] = document.getElementById('edge12');
      edges[2][3] = document.getElementById('edge23');
      edges[3][0] = document.getElementById('edge03');
      edges[3][1] = document.getElementById('edge13');
      edges[3][2] = document.getElementById('edge23');
      nodes = new Array();
      nodes[0] = document.getElementById('0');
      nodes[1] = document.getElementById('1');
      nodes[2] = document.getElementById('2');
      nodes[3] = document.getElementById('3');
      nodes[0].addEventListener("mousedown", mousedown_listener, false);
      nodes[1].addEventListener("mousedown", mousedown_listener, false);
      nodes[2].addEventListener("mousedown", mousedown_listener, false);
      nodes[3].addEventListener("mousedown", mousedown_listener, false);
    }      

    function mousedown_listener(evt)
    {
      selectedNode = evt.target;
      dx = selectedNode.cx.baseVal.value - evt.clientX;
      dy = selectedNode.cy.baseVal.value - evt.clientY;
      document.addEventListener("mousemove", mousemove_listener, true);
      document.addEventListener("mouseup", mouseup_listener, true);
    }

    function mouseup_listener(evt)
    {
      document.removeEventListener("mousemove", mousemove_listener, true);
      document.removeEventListener("mouseup", mouseup_listener, true);
    }

    function mousemove_listener(evt)
    {
      var id = selectedNode.ownerSVGElement.suspendRedraw(1000);
      var edge;
      edge = edges[0][0]
      for(i in edges[selectedNode.id]) {
        edge = edges[selectedNode.id][i];
        if(edge.x1.baseVal.value == selectedNode.cx.baseVal.value
            && edge.y1.baseVal.value == selectedNode.cy.baseVal.value ) {
          edge.x1.baseVal.value = evt.clientX + dx;
          edge.y1.baseVal.value = evt.clientY + dy;
        } else {
          edge.x2.baseVal.value = evt.clientX + dx;
          edge.y2.baseVal.value = evt.clientY + dy;
        }
      }
      selectedNode.cx.baseVal.value = evt.clientX + dx;
      selectedNode.cy.baseVal.value = evt.clientY + dy;
      selectedNode.ownerSVGElement.unsuspendRedraw(id);
    }

    ]]>
  </script>
  </head>
  <body onload="init();">
  <svg:svg width="800px" height="800px">
    <svg:polyline points="0,0 800,0 800,800 0,800 0,0" style="stroke:black; fill:none;"/>
    <svg:line id="edge01" x1="50" y1="50" x2="200" y2="50" style="stroke:rgb(100,100,100);stroke-width:2"/>
    <svg:line id="edge02" x1="50" y1="50" x2="50" y2="200" style="stroke:rgb(100,100,100);stroke-width:2"/>
    <svg:line id="edge03" x1="50" y1="50" x2="200" y2="200" style="stroke:rgb(100,100,100);stroke-width:2"/>
    <svg:line id="edge12" x1="200" y1="50" x2="50" y2="200" style="stroke:rgb(100,100,100);stroke-width:2"/>
    <svg:line id="edge13" x1="200" y1="50" x2="200" y2="200" style="stroke:rgb(100,100,100);stroke-width:2"/>
    <svg:line id="edge23" x1="50" y1="200" x2="200" y2="200" style="stroke:rgb(100,100,100);stroke-width:2"/>
    <svg:circle id="0" r="10" cx="50" cy="50" style="fill:blue; stroke:black; stroke-width:2;"/>
    <svg:circle id="1" r="10" cx="200" cy="50" style="fill:red; stroke:black; stroke-width:2;"/>
    <svg:circle id="2" r="10" cx="50" cy="200" style="fill:red; stroke:black; stroke-width:2;"/>
    <svg:circle id="3" r="10" cx="200" cy="200" style="fill:red; stroke:black; stroke-width:2;"/>
  </svg:svg>
  </body>
</html>
